<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Психологическое исследование</title>
<style>
/* Персиковая цветовая палитра */
:root {
  --peach-light: #FFE5D4;
  --peach-medium: #FFD1B3;
  --peach-dark: #FFB38A;
  --peach-accent: #FF8C5A;
  --text-dark: #5A3E36;
  --text-light: #7A5C52;
  --white: #FFF9F5;
  --shadow: rgba(90, 62, 54, 0.1);
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: var(--white);
  color: var(--text-dark);
  line-height: 1.6;
  padding: 20px;
  max-width: 1000px;
  margin: 0 auto;
  background-image: radial-gradient(var(--peach-light) 2px, transparent 2px);
  background-size: 30px 30px;
}

/* Заголовки */
h2, h3, h4 {
  color: var(--peach-accent);
  margin-bottom: 1rem;
  font-weight: 600;
}

h2 {
  font-size: 2rem;
  border-bottom: 3px solid var(--peach-medium);
  padding-bottom: 10px;
}

h3 {
  font-size: 1.5rem;
  margin-top: 1.5rem;
}

h4 {
  font-size: 1.2rem;
  color: var(--text-light);
}

/* Экраны */
.screen {
  display: none;
  background: white;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px var(--shadow);
  margin-bottom: 30px;
  border: 2px solid var(--peach-light);
}

.screen.active {
  display: block;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Вопросы */
.question {
  background: var(--peach-light);
  padding: 20px;
  margin-bottom: 15px;
  border-radius: 15px;
  border-left: 5px solid var(--peach-accent);
  transition: transform 0.3s ease;
  position: relative;
}

.question:hover {
  transform: translateX(5px);
}

.question label {
  display: inline-block;
  margin-right: 15px;
  margin-bottom: 8px;
  padding: 10px 18px;
  background: white;
  border-radius: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid var(--peach-medium);
  min-width: 140px;
  text-align: center;
}

.question label:hover {
  background: var(--peach-medium);
  transform: translateY(-2px);
  border-color: var(--peach-accent);
}

.question input[type="radio"]:checked + label {
  background: var(--peach-accent);
  color: white;
  border-color: var(--peach-dark);
  box-shadow: 0 4px 12px rgba(255, 140, 90, 0.3);
  transform: translateY(-2px);
}

.question input[type="radio"]:checked + label::after {
  content: " ✓";
  font-weight: bold;
  margin-left: 5px;
}

.question input[type="radio"] {
  display: none;
}

/* Индикатор ответа */
.answer-indicator {
  position: absolute;
  top: 15px;
  right: 15px;
  background: var(--peach-accent);
  color: white;
  padding: 5px 12px;
  border-radius: 15px;
  font-size: 0.9rem;
  font-weight: 600;
  display: none;
}

.question.answered .answer-indicator {
  display: block;
}

/* Поля ввода */
input[type="text"],
input[type="number"],
select {
  width: 100%;
  padding: 12px 15px;
  margin: 8px 0;
  border: 2px solid var(--peach-medium);
  border-radius: 10px;
  font-size: 1rem;
  transition: border-color 0.3s ease;
  background: white;
}

input[type="text"]:focus,
input[type="number"]:focus,
select:focus {
  outline: none;
  border-color: var(--peach-accent);
  box-shadow: 0 0 0 3px rgba(255, 140, 90, 0.2);
}

/* Кнопки */
button {
  background: linear-gradient(135deg, var(--peach-accent), var(--peach-dark));
  color: white;
  border: none;
  padding: 14px 28px;
  font-size: 1.1rem;
  border-radius: 50px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  letter-spacing: 0.5px;
  margin-top: 20px;
  box-shadow: 0 6px 20px rgba(255, 140, 90, 0.4);
  display: inline-block;
}

button:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(255, 140, 90, 0.5);
}

button:active {
  transform: translateY(-1px);
}

button:disabled {
  background: var(--peach-light);
  color: var(--text-light);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Прогресс бар */
.progress-container {
  width: 100%;
  background: var(--peach-light);
  height: 8px;
  border-radius: 4px;
  margin: 30px 0;
  overflow: hidden;
  position: relative;
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--peach-accent), var(--peach-dark));
  width: 0%;
  transition: width 0.5s ease;
  border-radius: 4px;
}

.progress-text {
  position: absolute;
  right: 0;
  top: -25px;
  color: var(--text-light);
  font-size: 0.9rem;
}

/* Блоки ПКГД */
.pkgd-block {
  background: linear-gradient(135deg, var(--white), var(--peach-light));
  padding: 20px;
  margin: 25px 0;
  border-radius: 15px;
  border: 2px solid var(--peach-medium);
  position: relative;
}

.pkgd-option {
  background: white;
  margin: 12px 0;
  padding: 15px;
  border-radius: 10px;
  border-left: 4px solid var(--peach-medium);
  transition: all 0.3s ease;
}

.pkgd-option:hover {
  transform: translateX(5px);
  border-left-color: var(--peach-accent);
}

.pkgd-option label {
  display: block;
  padding: 10px 15px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.pkgd-option input[type="radio"]:checked + label {
  background: var(--peach-light);
  border-left-color: var(--peach-accent);
  color: var(--text-dark);
  font-weight: 600;
}

.pkgd-option input[type="radio"]:checked + label::before {
  content: "✔ ";
  color: var(--peach-accent);
  margin-right: 8px;
}

.pkgd-option input[type="radio"] {
  display: none;
}

/* Инструкции */
.instruction {
  background: var(--peach-light);
  padding: 18px;
  border-radius: 12px;
  margin: 20px 0;
  font-style: italic;
  border-left: 4px solid var(--peach-accent);
  line-height: 1.5;
}

/* Чекбокс согласия */
.consent-checkbox {
  display: flex;
  align-items: center;
  background: var(--peach-light);
  padding: 15px;
  border-radius: 10px;
  margin: 20px 0;
}

#consent {
  margin-right: 15px;
  transform: scale(1.4);
  accent-color: var(--peach-accent);
}

/* Счетчик вопросов */
.question-counter {
  text-align: center;
  margin: 15px 0;
  color: var(--text-light);
  font-weight: 600;
  padding: 10px;
  background: var(--peach-light);
  border-radius: 10px;
}

/* Адаптивность */
@media (max-width: 768px) {
  body {
    padding: 10px;
  }
  
  .screen {
    padding: 20px;
  }
  
  .question label {
    display: block;
    margin-bottom: 10px;
    width: 100%;
    min-width: auto;
  }
  
  button {
    width: 100%;
    margin: 10px 0;
  }
  
  h2 {
    font-size: 1.5rem;
  }
  
  .pkgd-block {
    padding: 15px;
  }
}

/* Анимация загрузки */
.loading {
  display: none;
  text-align: center;
  padding: 40px;
}

.loading.active {
  display: block;
}

.spinner {
  border: 5px solid var(--peach-light);
  border-top: 5px solid var(--peach-accent);
  border-radius: 50%;
  width: 60px;
  height: 60px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Сообщения */
.message {
  padding: 15px;
  border-radius: 10px;
  margin: 15px 0;
  display: none;
}

.message.success {
  background: #E8F5E9;
  color: #2E7D32;
  border-left: 4px solid #4CAF50;
  display: block;
}

.message.error {
  background: #FFEBEE;
  color: #C62828;
  border-left: 4px solid #F44336;
  display: block;
}

/* Подсказки */
.tooltip {
  position: relative;
  display: inline-block;
  cursor: help;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 200px;
  background-color: var(--text-dark);
  color: white;
  text-align: center;
  border-radius: 6px;
  padding: 10px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -100px;
  opacity: 0;
  transition: opacity 0.3s;
  font-size: 0.9rem;
  font-weight: normal;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
}

/* Навигация */
.nav-buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 30px;
}

.nav-buttons button:first-child {
  background: var(--peach-light);
  color: var(--text-dark);
}

/* Статус заполнения */
.completion-status {
  display: flex;
  justify-content: space-between;
  margin: 20px 0;
  padding: 15px;
  background: var(--peach-light);
  border-radius: 10px;
}

.status-item {
  text-align: center;
  flex: 1;
}

.status-item.completed .status-circle {
  background: var(--peach-accent);
  color: white;
}

.status-circle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 10px;
  font-weight: bold;
  border: 2px solid var(--peach-medium);
}
</style>
</head>

<body>

<!-- 1. Приветствие -->
<div class="screen active" id="screen-consent">
  <h2>Уважаемые участницы исследования!</h2>
  
  <div class="instruction">
    <p>Я, <strong>Полухтина Валерия Вадимовна</strong>, студентка 5 курса факультета психологии, 
    провожу исследование в рамках выпускной квалификационной работы.</p>
    
    <p>Исследование посвящено <strong>особенностям тревожности, когнитивной регуляции эмоций, 
    когнитивной оценки стресса и психологической готовности к беременности</strong>.</p>
  </div>
  
  <p><strong>Вам нужно будет:</strong></p>
  <ul style="margin: 15px 0 15px 20px; color: var(--text-light);">
    <li>Пройти 4 психологических опросника</li>
    <li>Время заполнения: 25-30 минут</li>
    <li>Добровольное участие</li>
    <li>Анонимность и конфиденциальность данных</li>
    <li>Данные используются только в обобщённом виде</li>
  </ul>
  
  <div class="consent-checkbox">
    <input type="checkbox" id="consent">
    <label for="consent" style="font-weight: 600; cursor: pointer;">
      Я даю добровольное информированное согласие на участие в исследовании
    </label>
  </div>
  
  <button onclick="startSurvey()">Принять участие →</button>
  
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar"></div>
    <div class="progress-text">0%</div>
  </div>
  
  <div class="completion-status">
    <div class="status-item completed">
      <div class="status-circle">1</div>
      <div>Согласие</div>
    </div>
    <div class="status-item">
      <div class="status-circle">2</div>
      <div>Демография</div>
    </div>
    <div class="status-item">
      <div class="status-circle">3</div>
      <div>С-Х</div>
    </div>
    <div class="status-item">
      <div class="status-circle">4</div>
      <div>CERQ</div>
    </div>
    <div class="status-item">
      <div class="status-circle">5</div>
      <div>ССП</div>
    </div>
    <div class="status-item">
      <div class="status-circle">6</div>
      <div>ПКГД</div>
    </div>
  </div>
</div>

<!-- 2. Демография (ваш существующий код) -->
<div class="screen" id="screen-demography">
  <h2>Общие сведения</h2>
  
  <!-- Ваши поля демографии остаются без изменений -->
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Код участника или инициалы:</label>
    <input type="text" name="code" placeholder="Например: ИИ123" required>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Возраст (полных лет):</label>
    <input type="number" name="age" min="18" max="55" placeholder="25" required>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Город проживания:</label>
    <input type="text" name="city" placeholder="Москва" required>
  </div>
  
  <h3>Репродуктивный анамнез</h3>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Был ли у вас самопроизвольный аборт в анамнезе?</label>
    <label><input type="radio" name="group_abort" value="yes" required> Да</label>
    <label><input type="radio" name="group_abort" value="no"> Нет</label>
    <div class="answer-indicator">Выбрано</div>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Количество беременностей:</label>
    <input type="number" name="pregnancies" min="0" placeholder="0" required>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Количество самопроизвольных абортов:</label>
    <input type="number" name="miscarriages" min="0" placeholder="0" required>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Есть ли у вас живорождённые дети?</label>
    <label><input type="radio" name="children" value="yes" required> Да</label>
    <label><input type="radio" name="children" value="no"> Нет</label>
    <div class="answer-indicator">Выбрано</div>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Срок после последнего самопроизвольного аборта (в месяцах):</label>
    <input type="number" name="months_after_abort" placeholder="Оставьте пустым, если не было">
    <small style="display: block; color: var(--text-light); margin-top: 5px;">Если не было — оставьте пустым</small>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Планируете ли вы беременность в настоящее время?</label>
    <label><input type="radio" name="planning" value="yes" required> Да</label>
    <label><input type="radio" name="planning" value="no"> Нет</label>
    <div class="answer-indicator">Выбрано</div>
  </div>
  
  <h3>Психологический и медицинский контекст</h3>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Проходили ли вы психотерапию ранее?</label>
    <label><input type="radio" name="therapy" value="yes" required> Да</label>
    <label><input type="radio" name="therapy" value="no"> Нет</label>
    <div class="answer-indicator">Выбрано</div>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Принимаете ли вы в настоящее время психотропные препараты?</label>
    <label><input type="radio" name="meds" value="yes" required> Да</label>
    <label><input type="radio" name="meds" value="no"> Нет</label>
    <div class="answer-indicator">Выбрано</div>
  </div>
  
  <div class="question">
    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Уровень образования:</label>
    <select name="education" required>
      <option value="">Выберите уровень образования</option>
      <option>Среднее</option>
      <option>Среднее специальное</option>
      <option>Неоконченное высшее</option>
      <option>Высшее</option>
      <option>Ученая степень</option>
    </select>
  </div>
  
  <div class="nav-buttons">
    <button onclick="next('screen-demography','screen-stai')">Далее →</button>
  </div>
  
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar-demography"></div>
    <div class="progress-text">14%</div>
  </div>
</div>

<!-- 3. Спилбергер–Ханин (С-Х) -->
<div class="screen" id="screen-stai">
  <h2>Шкала тревожности</h2>
  
  <div class="instruction">
    <p><strong>Инструкция:</strong> Прочитайте внимательно каждое из приведённых ниже утверждений 
    и отметьте вариант ответа в зависимости от того, как вы себя чувствуете 
    <strong>в данный момент</strong> (вопросы 1-20) и <strong>обычно</strong> (вопросы 21-40).</p>
    <p>Над вопросами долго не задумывайтесь, правильных и неправильных ответов нет.</p>
  </div>
  
  <div class="question-counter">Вопрос <span id="stai-current">1</span> из 40</div>
  
  <!-- Вопросы СТАИ из вашего файла -->
  <div id="stai-questions">
    <!-- Вопросы будут добавлены через JavaScript -->
  </div>
  
  <div class="nav-buttons">
    <button onclick="next('screen-stai','screen-cerq')">Далее →</button>
  </div>
  
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar-stai"></div>
    <div class="progress-text">28%</div>
  </div>
</div>

<!-- 4. CERQ -->
<div class="screen" id="screen-cerq">
  <h2>Опросник когнитивной регуляции эмоций (CERQ)</h2>
  
  <div class="instruction">
    <p><strong>Инструкция:</strong> Ниже приводятся утверждения, касающиеся того, что вы думаете после того, 
    как с вами произошло неприятное или стрессовое событие. 
    Укажите, как часто вы думаете подобным образом.</p>
  </div>
  
  <div class="question-counter">Вопрос <span id="cerq-current">1</span> из 36</div>
  
  <!-- Вопросы CERQ из вашего файла -->
  <div id="cerq-questions">
    <!-- Вопросы будут добавлены через JavaScript -->
  </div>
  
  <div class="nav-buttons">
    <button onclick="next('screen-cerq','screen-lazarus')">Далее →</button>
  </div>
  
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar-cerq"></div>
    <div class="progress-text">50%</div>
  </div>
</div>

<!-- 5. ССП Лазаруса -->
<div class="screen" id="screen-lazarus">
  <h2>Стратегии совладания со стрессом</h2>
  
  <div class="instruction">
    <p><strong>Инструкция:</strong> Оказавшись в трудной жизненной ситуации, я...</p>
    <p>Оцените, как часто данные варианты поведения проявляются у вас:</p>
    <ul style="margin: 10px 0 10px 20px;">
      <li><strong>0 - Никогда</strong></li>
      <li><strong>1 - Редко</strong></li>
      <li><strong>2 - Иногда</strong></li>
      <li><strong>3 - Часто</strong></li>
    </ul>
  </div>
  
  <div class="question-counter">Вопрос <span id="lazarus-current">1</span> из 50</div>
  
  <!-- Вопросы ССП из вашего файла -->
  <div id="lazarus-questions">
    <!-- Вопросы будут добавлены через JavaScript -->
  </div>
  
  <div class="nav-buttons">
    <button onclick="next('screen-lazarus','screen-pkgd')">Далее →</button>
  </div>
  
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar-lazarus"></div>
    <div class="progress-text">72%</div>
  </div>
</div>

<!-- 6. ПКГД -->
<div class="screen" id="screen-pkgd">
  <h2>Психологическая готовность к беременности</h2>
  
  <div class="instruction">
    <p><strong>Инструкция:</strong> Просим вас из пяти утверждений, представленных в блоках, 
    выбрать одно, наиболее полно отражающее ваше состояние.</p>
  </div>
  
  <div class="question-counter">Блок <span id="pkgd-current">1</span> из 9</div>
  
  <!-- Блоки ПКГД из вашего файла -->
  <div id="pkgd-questions">
    <!-- Блоки будут добавлены через JavaScript -->
  </div>
  
  <div class="nav-buttons">
    <button onclick="submitAllData()">Завершить и отправить данные →</button>
  </div>
  
  <div class="progress-container">
    <div class="progress-bar" id="progress-bar-pkgd"></div>
    <div class="progress-text">86%</div>
  </div>
</div>

<!-- 7. Завершение -->
<div class="screen" id="screen-finish">
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <h3>Отправка данных...</h3>
    <p>Пожалуйста, не закрывайте страницу</p>
  </div>
  
  <div id="success-message" style="display: none;">
    <h2 style="color: var(--peach-accent);">✅ Спасибо за участие!</h2>
    <div class="message success">
      <p>Ваши ответы успешно сохранены.</p>
      <p>Данные будут использованы только в обобщённом виде для научного исследования.</p>
    </div>
    
    <div style="background: var(--peach-light); padding: 20px; border-radius: 15px; margin: 30px 0;">
      <h4>Важно❗️</h4>
      <ul style="margin: 15px 0 15px 20px;">
        <li>Если у вас есть вопросы, свяжитесь с со мной ТГ - @lulerochka</li>
        <li>Благодарю за ваш вклад в науку!</li>
      </ul>
      </div>
    </div>
  
  <div id="error-message" style="display: none;">
    <h2 style="color: #F44336;">⚠️ Ошибка отправки</h2>
    <div class="message error">
      <p>Произошла ошибка при отправке данных.</p>
      <p>Пожалуйста, попробуйте еще раз или свяжитесь с со мной.</p>
    </div>
    <button onclick="submitAllData()">Попробовать снова</button>
  </div>
  
  <div class="progress-container">
    <div class="progress-bar" style="width: 100%;"></div>
    <div class="progress-text">100%</div>
  </div>
</div>

<script>
// ========== КОНФИГУРАЦИЯ ==========
const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSe0sozn9RHWrYtqFSaiWfF1fhx1wfRMqVxwkZJH21dWcgovyg/formResponse';
const GOOGLE_FORM_FIELD = 'entry.2134456026'; 'entry.300457556'; 'entry.1439011840'; 'entry.862194608'; 'entry.1991637437'; 'entry.2016809335'; 'entry.1515712681'; 'entry.552834598'; 'entry.171709964'; 'entry.114096340';/ <-- ВАШ ID ПОЛЯ

// ========== ДАННЫЕ ВОПРОСОВ ==========

// 1. СТАИ вопросы (из вашего файла)
const staiQuestions = [
  "Я спокоен",
  "Мне ничто не угрожает",
  "Я нахожусь в напряжении",
  "Я внутренне скован",
  "Я чувствую себя свободно",
  "Я расстроен",
  "Меня волнуют возможные неудачи",
  "Я ощущаю душевный покой",
  "Я встревожен",
  "Я испытываю чувство внутреннего удовлетворения",
  "Я уверен в себе",
  "Я нервничаю",
  "Я не нахожу себе места",
  "Я взвинчен",
  "Я не чувствую скованности, напряжения",
  "Я доволен",
  "Я озабочен",
  "Я слишком возбужден и мне не по себе",
  "Мне радостно",
  "Мне приятно",
  "У меня бывает приподнятое настроение",
  "Я бываю раздражительным",
  "Я легко расстраиваюсь",
  "Я хотел бы быть таким же удачливым, как и другие",
  "Я сильно переживаю неприятности и долго не могу о них забыть",
  "Я чувствую прилив сил и желание работать",
  "Я спокоен, хладнокровен и собран",
  "Меня тревожат возможные трудности",
  "Я слишком переживаю из-за пустяков",
  "Я бываю вполне счастлив",
  "Я все принимаю близко к сердцу",
  "Мне не хватает уверенности в себе",
  "Я чувствую себя беззащитным",
  "Я стараюсь избегать критических ситуаций и трудностей",
  "У меня бывает хандра",
  "Я бываю доволен",
  "Всякие пустяки отвлекают и волнуют меня",
  "Бывает, что я чувствую себя неудачником",
  "Я уравновешенный человек",
  "Меня охватывает беспокойство, когда я думаю о своих делах и заботах"
];

// 2. CERQ вопросы (из вашего файла)
const cerqQuestions = [
  "Я чувствую, что в происходящем следует винить себя",
  "Я думаю, что мне придется принять то, что это произошло",
  "Я часто думаю о том, что чувствую по поводу произошедшего",
  "Я думаю о более приятных вещах, чем то, что произошло",
  "Я думаю о том, что лучше всего сделать в этой ситуации",
  "Я думаю, что эта ситуация может меня чему-то научить",
  "Я думаю, что все могло бы быть гораздо хуже",
  "Я постоянно думаю, что случившееся со мной — это катастрофа",
  "Я чувствую, что в произошедшем следует винить других",
  "Я думаю, что сам виноват в том, что произошло",
  "Я думаю, что должен смириться с произошедшим",
  "Я снова и снова возвращаюсь мыслями к произошедшему",
  "Я думаю о приятных вещах, которые не имеют отношения к ситуации",
  "Я думаю о том, как справиться с ситуацией",
  "Я думаю, что могу стать сильнее благодаря этому",
  "Я думаю, что другим людям бывает гораздо хуже",
  "Я думаю, что это худшее, что могло со мной случиться",
  "Я думаю, что другие виноваты в том, что произошло",
  "Я корю себя за то, что это произошло",
  "Я думаю, что должен научиться жить с этим",
  "Я постоянно думаю о том, как мне плохо из-за случившегося",
  "Я думаю о приятных вещах, которые произошли со мной раньше",
  "Я думаю о конкретных шагах, которые нужно предпринять",
  "Я думаю, что в будущем из этого может выйти что-то хорошее",
  "Я думаю, что по сравнению с этим другие проблемы не так уж важны",
  "Я постоянно думаю, что ситуация ужасна",
  "Я думаю, что другие плохо со мной поступили",
  "Я думаю, что сам допустил ошибку",
  "Я думаю, что должен научиться принимать происходящее",
  "Я снова и снова прокручиваю произошедшее в голове",
  "Я стараюсь думать о приятных вещах",
  "Я думаю, что могу что-то предпринять, чтобы улучшить ситуацию",
  "Я думаю, что в итоге из этого можно извлечь пользу",
  "Я думаю, что по сравнению с этим другие проблемы незначительны",
  "Я постоянно думаю, что это худшее, что могло случиться",
  "Я думаю, что другие ответственны за то, что произошло"
];

// 3. ССП Лазаруса вопросы (из вашего файла)
const lazarQuestions = [
  "сосредотачивался на том, что мне нужно было делать дальше - на следующем шаге",
  "начинал что-то делать, зная, что это все равно не будет работать, главное - делать хоть что-нибудь",
  "пытался склонить вышестоящих к тому, чтобы они изменили свое мнение",
  "говорил с другими, чтобы больше узнать о ситуации",
  "критиковал и укорял себя",
  "пытался не сжигать за собой мосты, оставляя все, как оно есть",
  "надеялся на чудо",
  "смирялся с судьбой: бывает, что мне не везет",
  "вел себя, как будто ничего не произошло",
  "старался не показывать своих чувств",
  "пытался увидеть в ситуации что-то положительное",
  "спал больше обычного",
  "срывал свою досаду на тех, кто навлек на меня проблемы",
  "искал сочувствия и понимания у кого-нибудь",
  "во мне возникла потребность выразить себя творчески",
  "пытался забыть все это",
  "обращался за помощью к специалистам",
  "менялся или рос как личность в положительную сторону",
  "извинялся или старался все загладить",
  "составлял план действий",
  "старался дать какой-то выход своим чувствам",
  "понимал, что сам вызвал эту проблему",
  "набирался опыта в этой ситуации",
  "говорил с кем-либо, кто мог конкретно помочь в этой ситуации",
  "пытался улучшить свое самочувствие едой, выпивкой, курением или лекарствами",
  "рисковал напропалую",
  "старался действовать не слишком поспешно, доверяясь первому порыву",
  "находил новую веру во что-то",
  "вновь открывал для себя что-то важное",
  "что-то менял так, что все улаживалось",
  "в целом избегал общения с людьми",
  "не допускал это до себя, стараясь об этом особенно не задумываться",
  "спрашивал совета у родственника или друга, которых уважал",
  "старался, чтобы другие не узнали, как плохо обстоят дела",
  "отказывался воспринимать это слишком серьезно",
  "говорил о том, что я чувствую",
  "стоял на своем и боролся за то, чего хотел",
  "вымещал это на других людях",
  "пользовался прошлым опытом - мне приходилось уже попадать в такие ситуации",
  "знал, что надо делать и удваивал свои усилия, чтобы все наладить",
  "отказывался верить, что это действительно произошло",
  "я давал обещание, что в следующий раз все будет по-другому",
  "находил пару других способов решения проблемы",
  "старался, что мои эмоции не слишком мешали мне в других делах",
  "что-то менял в себе",
  "хотел, чтобы все это скорее как-то образовалось или кончилось",
  "представлял себе, фантазировал, как все это могло бы обернуться",
  "молился",
  "прокручивал в уме, что мне сказать или сделать",
  "думал о том, как бы в данной ситуации действовал человек, которым я восхищаюсь и старался подражать ему"
];

// 4. ПКГД блоки (из вашего файла)
const pkgdBlocks = [
  {
    title: "А I",
    options: [
      "Ничто не доставляет мне такого счастья, как сознание того, что я беременна",
      "Я не испытываю никаких особых эмоций, связанных с тем, что я беременна",
      "С тех пор, как я узнала, что беременна, я нахожусь в нервном напряжении",
      "В основном мне приятно сознавать, что я беременна",
      "Я очень расстроена тем, что беременна"
    ]
  },
  {
    title: "А II",
    options: [
      "Беременность заставила меня полностью изменить образ жизни",
      "Беременность не заставила меня существенно изменить образ жизни, но я стала кое в чем себя ограничивать",
      "Беременность я не считаю поводом для того, чтобы менять образ жизни",
      "Беременность так изменила образ моей жизни, что она стала прекрасной",
      "Беременность заставила меня отказаться от многих планов, теперь не суждено сбыться многим моим надеждам"
    ]
  },
  {
    title: "А III",
    options: [
      "Я стараюсь вообще не думать ни о беременности, ни о предстоящих родах",
      "Я постоянно думаю о родах, очень их боюсь",
      "Я думаю, что во время родов все смогу сделать правильно, и не испытываю особого страха перед ними",
      "Когда я задумываюсь о предстоящих родах, настроение у меня ухудшается, так как я почти не сомневаюсь в их плохом исходе",
      "Я думаю о родах как о предстоящем празднике"
    ]
  },
  {
    title: "Б I",
    options: [
      "Я сомневаюсь в том, что смогу справляться с обязанностями матери",
      "Я считаю, что не смогу стать хорошей матерью",
      "Я не задумываюсь о предстоящем материнстве",
      "Я уверена, что стану прекрасной матерью",
      "Я полагаю, что если постараюсь, то смогу стать хорошей матерью"
    ]
  },
  {
    title: "Б II",
    options: [
      "Я часто с удовольствием представляю себе ребенка, которого вынашиваю, разговариваю с ним",
      "Я понимаю ребенка, которого вынашиваю, восхищаюсь им и считаю, что он знает и понимает все, о чем я думаю",
      "Я постоянно беспокоюсь о состоянии здоровья ребенка, которого вынашиваю, стараюсь его почувствовать",
      "Я не думаю о том, каким будет ребенок, которого вынашиваю",
      "Я часто думаю о том, что ребенок, которого вынашиваю, будет каким-нибудь неполноценным, и очень боюсь этого"
    ]
  },
  {
    title: "Б III",
    options: [
      "Я не думаю о том, как буду кормить ребенка грудью",
      "Я с восторгом представляю себе, как буду кормить ребенка грудью",
      "Я думаю, что буду кормить ребенка грудью",
      "Я беспокоюсь о том, что у меня будут проблемы с кормлением грудью",
      "Я почти уверена, что вряд ли смогу кормить ребенка грудью"
    ]
  },
  {
    title: "В I",
    options: [
      "Считаю, что беременность сделала меня еще прекрасней в глазах отца моего ребенка",
      "Моя беременность никак не изменила отношения ко мне отца моего ребенка",
      "Из-за беременности отец моего ребенка стал внимательнее и теплее относиться ко мне",
      "Из-за беременности я стала некрасивой, и отец моего ребенка стал холоднее относиться ко мне",
      "Боюсь, что изменения, связанные с беременностью, могут ухудшить отношение ко мне отца моего ребенка"
    ]
  },
  {
    title: "В II",
    options: [
      "Большинство близких мне людей разделяют мою радость по поводу беременности, и мне хорошо с ними",
      "Не все близкие мне люди достаточно рады тому, что я беременна, не все понимают, что я теперь нуждаюсь в особом отношении",
      "Большинство близких мне людей не одобряют то, что я беременна, мои отношения с ними ухудшились",
      "Меня мало интересует отношение к моей беременности даже близких мне людей",
      "Некоторые близкие мне люди относятся к моей беременности неоднозначно, и это меня тревожит"
    ]
  },
  {
    title: "В III",
    options: [
      "Мне всегда мучительно стыдно, когда окружающие замечают, что я «в положении»",
      "Мне немного не по себе, когда окружающие замечают, что я «в положении»",
      "Мне приятно, когда окружающие замечают, что я «в положении»",
      "Мне наплевать, замечают окружающие или нет, что я «в положении»",
      "Я не испытываю особой неловкости, если окружающие замечают, что я «в положении»"
    ]
  }
];

// ========== ТАБЛИЦЫ Т-БАЛЛОВ (такие же как в предыдущем коде) ==========
const tScoreTables = {
  women: {
    confrontation: {
      до20: [16,20,24,28,32,36,39,43,47,51,55,59,63,67,71,75,78,82,86],
      2130: [17,21,24,28,32,35,39,43,46,50,54,58,61,65,68,72,76,79,83],
      3145: [15,19,23,27,31,36,40,44,48,52,56,60,64,68,72,76,80,84,89],
      4660: [14,18,22,26,30,34,38,42,46,50,53,57,61,65,69,73,77,81,85]
    },
    // ... остальные таблицы такие же как в предыдущем коде
    // Для краткости оставляю только одну, в полном коде будут все
  }
};

// ========== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ==========
let allData = {};
let currentAnswers = {}; // Для отслеживания выбранных ответов

// ========== ИНИЦИАЛИЗАЦИЯ ==========
document.addEventListener('DOMContentLoaded', function() {
  // Добавляем вопросы СТАИ
  const staiContainer = document.getElementById('stai-questions');
  staiQuestions.forEach((question, index) => {
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `
      <strong>${index + 1}. ${question}</strong><br>
      <label><input type="radio" name="q${index + 1}" value="1" required> Никогда</label>
      <label><input type="radio" name="q${index + 1}" value="2"> Почти никогда</label>
      <label><input type="radio" name="q${index + 1}" value="3"> Часто</label>
      <label><input type="radio" name="q${index + 1}" value="4"> Почти всегда</label>
      <div class="answer-indicator">✓ Ответ выбран</div>
    `;
    staiContainer.appendChild(div);
  });
  
  // Добавляем вопросы CERQ
  const cerqContainer = document.getElementById('cerq-questions');
  cerqQuestions.forEach((question, index) => {
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `
      <strong>${index + 1}. ${question}</strong><br>
      <label><input type="radio" name="c${index + 1}" value="1" required> Почти никогда</label>
      <label><input type="radio" name="c${index + 1}" value="2"> Иногда</label>
      <label><input type="radio" name="c${index + 1}" value="3"> Регулярно</label>
      <label><input type="radio" name="c${index + 1}" value="4"> Часто</label>
      <label><input type="radio" name="c${index + 1}" value="5"> Почти всегда</label>
      <div class="answer-indicator">✓ Ответ выбран</div>
    `;
    cerqContainer.appendChild(div);
  });
  
  // Добавляем вопросы ССП Лазаруса
  const lazarContainer = document.getElementById('lazarus-questions');
  lazarQuestions.forEach((question, index) => {
    const div = document.createElement('div');
    div.className = 'question';
    div.innerHTML = `
      <strong>${index + 1}. Оказавшись в трудной ситуации, я ${question}</strong><br>
      <label><input type="radio" name="l${index + 1}" value="0" required> Никогда</label>
      <label><input type="radio" name="l${index + 1}" value="1"> Редко</label>
      <label><input type="radio" name="l${index + 1}" value="2"> Иногда</label>
      <label><input type="radio" name="l${index + 1}" value="3"> Часто</label>
      <div class="answer-indicator">✓ Ответ выбран</div>
    `;
    lazarContainer.appendChild(div);
  });
  
  // Добавляем блоки ПКГД
  const pkgdContainer = document.getElementById('pkgd-questions');
  pkgdBlocks.forEach((block, blockIndex) => {
    const blockDiv = document.createElement('div');
    blockDiv.className = 'pkgd-block';
    blockDiv.innerHTML = `<h4>${block.title}</h4>`;
    
    block.options.forEach((option, optionIndex) => {
      const optionDiv = document.createElement('div');
      optionDiv.className = 'pkgd-option';
      optionDiv.innerHTML = `
        <label>
          <input type="radio" name="p${blockIndex + 1}" value="${optionIndex + 1}" required>
          ${option}
        </label>
      `;
      blockDiv.appendChild(optionDiv);
    });
    
    pkgdContainer.appendChild(blockDiv);
  });
  
  // Добавляем обработчики для отслеживания выбора
  setupAnswerTracking();
  
  // Восстанавливаем сохраненные ответы
  restoreAnswers();
});

// ========== ОТСЛЕЖИВАНИЕ ВЫБОРА ОТВЕТОВ ==========
function setupAnswerTracking() {
  // Отслеживаем выбор радиокнопок
  document.addEventListener('change', function(e) {
    if (e.target.type === 'radio') {
      // Показываем индикатор выбора
      const questionDiv = e.target.closest('.question');
      if (questionDiv) {
        questionDiv.classList.add('answered');
        
        // Сохраняем выбор
        const questionName = e.target.name;
        const questionValue = e.target.value;
        currentAnswers[questionName] = questionValue;
        
        // Обновляем счетчик
        updateQuestionCounters();
      }
      
      // Для блоков ПКГД
      const pkgdOption = e.target.closest('.pkgd-option');
      if (pkgdOption) {
        // Убираем выделение у других вариантов в этом блоке
        const block = pkgdOption.closest('.pkgd-block');
        block.querySelectorAll('.pkgd-option').forEach(opt => {
          opt.style.borderLeftColor = 'var(--peach-medium)';
        });
        
        // Выделяем выбранный вариант
        pkgdOption.style.borderLeftColor = 'var(--peach-accent)';
      }
    }
  });
  
  // Отслеживаем ввод в текстовые поля
  document.addEventListener('input', function(e) {
    if (e.target.type === 'text' || e.target.type === 'number') {
      const questionDiv = e.target.closest('.question');
      if (questionDiv && e.target.value.trim() !== '') {
        questionDiv.classList.add('answered');
      }
    }
  });
}

// ========== ОБНОВЛЕНИЕ СЧЕТЧИКОВ ==========
function updateQuestionCounters() {
  // СТАИ
  const staiAnswered = document.querySelectorAll('#screen-stai .question.answered').length;
  document.getElementById('stai-current').textContent = staiAnswered;
  
  // CERQ
  const cerqAnswered = document.querySelectorAll('#screen-cerq .question.answered').length;
  document.getElementById('cerq-current').textContent = cerqAnswered;
  
  // ССП
  const lazarusAnswered = document.querySelectorAll('#screen-lazarus .question.answered').length;
  document.getElementById('lazarus-current').textContent = lazarusAnswered;
  
  // ПКГД
  const pkgdAnswered = document.querySelectorAll('#screen-pkgd .pkgd-option input:checked').length;
  document.getElementById('pkgd-current').textContent = pkgdAnswered;
}

// ========== НАВИГАЦИЯ ==========
function startSurvey() {
  if (!document.getElementById('consent').checked) {
    alert("Пожалуйста, дайте согласие на участие в исследовании");
    return;
  }
  next('screen-consent', 'screen-demography');
}

function next(current, nextScreen) {
  // Проверяем заполнение
  if (!validateScreen(current)) {
    return;
  }
  
  // Сохраняем данные
  saveScreenData(current);
  
  // Переключаем экраны
  document.getElementById(current).classList.remove('active');
  document.getElementById(nextScreen).classList.add('active');
  
  // Обновляем прогресс
  updateProgress();
  updateQuestionCounters();
  
  // Прокрутка наверх
  window.scrollTo(0, 0);
}

function prev(current, prevScreen) {
  document.getElementById(current).classList.remove('active');
  document.getElementById(prevScreen).classList.add('active');
  updateProgress();
  window.scrollTo(0, 0);
}

// ========== ВАЛИДАЦИЯ ==========
function validateScreen(screenId) {
  const screen = document.getElementById(screenId);
  const requiredInputs = screen.querySelectorAll('[required]');
  let isValid = true;
  let firstInvalid = null;
  
  requiredInputs.forEach(input => {
    if (input.type === 'radio') {
      const name = input.name;
      const checked = screen.querySelector(`input[name="${name}"]:checked`);
      if (!checked) {
        isValid = false;
        if (!firstInvalid) {
          firstInvalid = input.closest('.question') || input.closest('.pkgd-block');
        }
      }
    } else if (input.type === 'checkbox') {
      if (!input.checked) {
        isValid = false;
        if (!firstInvalid) firstInvalid = input;
      }
    } else {
      if (!input.value.trim()) {
        isValid = false;
        if (!firstInvalid) firstInvalid = input;
      }
    }
  });
  
  if (!isValid) {
    alert("Пожалуйста, заполните все обязательные поля");
    if (firstInvalid) {
      firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
      // Анимация внимания
      firstInvalid.style.animation = 'none';
      setTimeout(() => {
        firstInvalid.style.animation = 'shake 0.5s';
      }, 10);
    }
    return false;
  }
  
  return true;
}

// ========== СОХРАНЕНИЕ И ВОССТАНОВЛЕНИЕ ==========
function saveScreenData(screenId) {
  const screen = document.getElementById(screenId);
  const inputs = screen.querySelectorAll('input, select, textarea');
  
  inputs.forEach(input => {
    if (input.type === 'radio') {
      if (input.checked) {
        allData[input.name] = input.value;
        localStorage.setItem(input.name, input.value);
      }
    } else if (input.type === 'checkbox') {
      allData[input.name] = input.checked;
      localStorage.setItem(input.name, input.checked);
    } else {
      allData[input.name] = input.value;
      if (input.value) {
        localStorage.setItem(input.name, input.value);
      }
    }
  });
}

function restoreAnswers() {
  // Восстанавливаем из localStorage
  const inputs = document.querySelectorAll('input, select, textarea');
  inputs.forEach(input => {
    const saved = localStorage.getItem(input.name);
    if (saved !== null) {
      if (input.type === 'radio') {
        if (input.value === saved) {
          input.checked = true;
          // Активируем индикатор
          const questionDiv = input.closest('.question');
          if (questionDiv) {
            questionDiv.classList.add('answered');
          }
        }
      } else if (input.type === 'checkbox') {
        input.checked = saved === 'true';
      } else {
        input.value = saved;
        if (saved) {
          const questionDiv = input.closest('.question');
          if (questionDiv) {
            questionDiv.classList.add('answered');
          }
        }
      }
      allData[input.name] = saved;
    }
  });
  
  updateQuestionCounters();
}

// ========== ПРОГРЕСС ==========
function updateProgress() {
  const screens = ['screen-consent', 'screen-demography', 'screen-stai', 'screen-cerq', 'screen-lazarus', 'screen-pkgd'];
  const currentIndex = screens.findIndex(id => document.getElementById(id).classList.contains('active'));
  
  if (currentIndex >= 0) {
    const progress = ((currentIndex + 1) / screens.length) * 100;
    document.querySelectorAll('.progress-bar').forEach(bar => {
      bar.style.width = `${progress}%`;
    });
    document.querySelectorAll('.progress-text').forEach(text => {
      text.textContent = `${Math.round(progress)}%`;
    });
    
    // Обновляем статус
    document.querySelectorAll('.status-item').forEach((item, index) => {
      if (index <= currentIndex) {
        item.classList.add('completed');
      } else {
        item.classList.remove('completed');
      }
    });
  }
}

// === СТАИ: ПРАВИЛЬНЫЙ ПОДСЧЕТ ===
function calculateStaiState() {
  // Ключ: для СИТУАТИВНОЙ тревожности (вопросы 1-20)
  // 1,2,5,8,10,11,15,16,19,20 - ОБРАТНЫЕ (4,3,2,1)
  // остальные - ПРЯМЫЕ (1,2,3,4)
  
  const reverseQuestionsST = [1,2,5,8,10,11,15,16,19,20];
  let sum = 0;
  
  for (let i = 1; i <= 20; i++) {
    const answer = parseInt(allData['q' + i]) || 1; // 1-4
    if (reverseQuestionsST.includes(i)) {
      // Обратные: 4→1, 3→2, 2→3, 1→4
      sum += (5 - answer);
    } else {
      // Прямые: как есть
      sum += answer;
    }
  }
  return sum; // 20-80 баллов
}

function calculateStaiTrait() {
  // Ключ: для ЛИЧНОСТНОЙ тревожности (вопросы 21-40)
  // 21,26,27,30,33,36,39 - ОБРАТНЫЕ (4,3,2,1)
  // остальные - ПРЯМЫЕ (1,2,3,4)
  
  const reverseQuestionsLT = [21,26,27,30,33,36,39];
  let sum = 0;
  
  for (let i = 21; i <= 40; i++) {
    const answer = parseInt(allData['q' + i]) || 1;
    if (reverseQuestionsLT.includes(i)) {
      sum += (5 - answer);
    } else {
      sum += answer;
    }
  }
  return sum; // 20-80 баллов
}

// === CERQ: 9 ШКАЛ (по 4 вопроса каждая) ===
function calculateCerqScores() {
  const scales = {
    self_blame: [1,10,19,28],
    acceptance: [2,11,20,29],
    rumination: [3,12,21,30],
    positive_refocus: [4,13,22,31],
    refocus_plan: [5,14,23,32],
    positive_reappraisal: [6,15,24,33],
    putting_perspective: [7,16,25,34],
    catastrophizing: [8,17,26,35],
    blaming_others: [9,18,27,36]
  };
  
  const scores = {};
  for (const [scaleName, questions] of Object.entries(scales)) {
    scores[scaleName] = questions.reduce((sum, q) => {
      return sum + (parseInt(allData['c' + q]) || 1);
    }, 0);
  }
  return scores;
}

// === ССП ЛАЗАРУСА: 8 ШКАЛ ===
function calculateLazarusScores() {
  const scales = {
    confrontive: [2,3,13,21,26,37],          // Конфронтационный копинг
    distancing: [8,9,11,16,32,35],           // Дистанцирование
    self_control: [6,10,27,34,44,49,50],     // Самоконтроль
    seeking_social: [4,14,17,24,33,36],      // Поиск социальной поддержки
    accepting_resp: [5,19,22,42],            // Принятие ответственности
    escape_avoid: [7,12,25,31,38,41,46,47],  // Бегство-избегание
    planful: [1,20,30,39,40,43],             // Планирование решения
    positive_reappraisal: [15,18,23,28,29,45,48] // Положительная переоценка
  };
  
  const scores = {};
  for (const [scaleName, questions] of Object.entries(scales)) {
    scores[scaleName] = questions.reduce((sum, q) => {
      return sum + (parseInt(allData['l' + q]) || 0); // 0-3
    }, 0);
  }
  return scores;
}
  
  // === ПКГД (ТОБ): 5 ТИПОВ ГОТОВНОСТИ ===
function calculatePkgdScores() {
  // Ключ перевода выбранного варианта в тип
  // Каждый блок (A-I, A-II, ...) имеет свой ключ
  const typeKeys = {
    // Блок: [О, Г, Э, Т, Д] для вариантов 1-5
    'p1': [4,2,1,3,5],  // A-I
    'p2': [2,3,4,1,5],  // A-II
    'p3': [3,1,5,2,4],  // A-III
    'p4': [5,3,4,1,2],  // Б-I
    'p5': [1,4,2,3,5],  // Б-II
    'p6': [3,1,2,5,4],  // Б-III
    'p7': [3,2,1,5,4],  // В-I
    'p8': [1,4,2,5,3],  // В-II
    'p9': [5,4,3,2,1]   // В-III
  };
  
  const typeSums = { О: 0, Г: 0, Э: 0, Т: 0, Д: 0 };
  
  // Подсчитываем баллы по типам
  for (let i = 1; i <= 9; i++) {
    const answer = parseInt(allData['p' + i]) || 1; // 1-5
    const key = typeKeys['p' + i];
    
    if (key && answer >= 1 && answer <= 5) {
      // answer=1 → key[0], answer=2 → key[1], ...
      const typeIndex = ['О', 'Г', 'Э', 'Т', 'Д'][key[answer-1]-1];
      typeSums[typeIndex]++;
    }
  }
  
  return {
    О: typeSums.О,  // Оптимальный тип
    Г: typeSums.Г,  // Гипогестогнозический
    Э: typeSums.Э,  // Эйфорический
    Т: typeSums.Т,  // Тревожный
    Д: typeSums.Д,  // Депрессивный
    total: Object.values(typeSums).reduce((a, b) => a + b, 0) // 9 всегда
  };
}

async function submitAllData() {
  try {
    saveScreenData('screen-pkgd');
    
    // === 1. СБОР ВСЕХ ДАННЫХ ===
    
    // Демография
    const demographics = {
      code: allData.code || '',
      age: allData.age || '',
      city: allData.city || '',
      group_abort: allData.group_abort || '',
      pregnancies: allData.pregnancies || '',
      miscarriages: allData.miscarriages || '',
      children: allData.children || '',
      months_after_abort: allData.months_after_abort || '',
      planning: allData.planning || '',
      therapy: allData.therapy || '',
      meds: allData.meds || '',
      education: allData.education || ''
    };
    
    // Функция сбора вопросов
    function collectQuestions(prefix, start, end) {
      const result = {};
      for (let i = start; i <= end; i++) {
        result[`${prefix}${i}`] = allData[`${prefix}${i}`] || '';
      }
      return result;
    }
    
    // Ответы по методикам
    const staiAnswers = collectQuestions('q', 1, 40);
    const cerqAnswers = collectQuestions('c', 1, 36);
    const lazarAnswers = collectQuestions('l', 1, 50);
    const pkgdAnswers = collectQuestions('p', 1, 9);
    
   // === 2. РАСЧЕТ БАЛЛОВ ПО КЛЮЧАМ ===

// СТАИ баллы
const staiScores = {
  state: calculateStaiState(),
  trait: calculateStaiTrait()
};

// CERQ баллы (9 шкал)
const cerqScores = calculateCerqScores();

// ССП Лазаруса баллы (8 шкал)
const lazarScores = calculateLazarusScores();

// ПКГД баллы (5 типов + итог)
const pkgdScores = calculatePkgdScores();
const pkgdScore = pkgdScores.total; // для 10-го поля
    
    // === 3. ОТПРАВКА В 10 ПОЛЕЙ ===
    
    // ВАШИ ID ПОЛЕЙ
    const FIELD_IDS = [
      'entry.2134456026', // 1. Код участника
      'entry.300457556',  // 2. Демография (JSON)
      'entry.1439011840', // 3. СТАИ ответы (JSON)
      'entry.862194608',  // 4. СТАИ баллы (JSON)
      'entry.1991637437', // 5. CERQ ответы (JSON)
      'entry.2016809335', // 6. CERQ баллы (JSON)
      'entry.1515712681', // 7. ССП ответы (JSON)
      'entry.552834598',  // 8. ССП баллы (JSON)
      'entry.171709964',  // 9. ПКГД ответы (JSON)
      'entry.114096340'   // 10. ПКГД балл (число)
    ];
    
    const formData = new FormData();
    
    // Заполняем все 10 полей
    formData.append(FIELD_IDS[0], demographics.code);
    formData.append(FIELD_IDS[1], JSON.stringify(demographics, null, 2));
    formData.append(FIELD_IDS[2], JSON.stringify(staiAnswers, null, 2));
    formData.append(FIELD_IDS[3], JSON.stringify(staiScores, null, 2));
    formData.append(FIELD_IDS[4], JSON.stringify(cerqAnswers, null, 2));
    formData.append(FIELD_IDS[5], JSON.stringify(cerqScores, null, 2));
    formData.append(FIELD_IDS[6], JSON.stringify(lazarAnswers, null, 2));
    formData.append(FIELD_IDS[7], JSON.stringify(lazarScores, null, 2));
    formData.append(FIELD_IDS[8], JSON.stringify(pkgdAnswers, null, 2));
    formData.append(FIELD_IDS[9], pkgdScore.toString());
    
    // === 4. ОТПРАВКА ===
    
    document.getElementById('screen-pkgd').classList.remove('active');
    document.getElementById('screen-finish').classList.add('active');
    document.getElementById('loading').classList.add('active');
    
    await fetch(GOOGLE_FORM_URL, {
      method: 'POST',
      mode: 'no-cors',
      body: formData
    });
    
    setTimeout(() => {
      document.getElementById('loading').classList.remove('active');
      document.getElementById('success-message').style.display = 'block';
      localStorage.clear();
    }, 2000);
    
  } catch (error) {
    console.error('Ошибка:', error);
    document.getElementById('loading').classList.remove('active');
    document.getElementById('error-message').style.display = 'block';
  }
}

// Добавляем анимацию тряски для валидации
const style = document.createElement('style');
style.textContent = `
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
  }
`;
document.head.appendChild(style);
</script>
</body>
</html>
